## 2026/01/23まとめ（Nozomiさんの進捗ログ）
🗂 1. Supabase に tasks テーブルを作成
- id / summary / description / status の4つのカラムを持つテーブルを作成
- SQL の構文エラーを修正しながら、正しく作成完了
- 既存テーブルの削除 → 再作成も経験して理解が深まった

🔌 2. Supabase の接続 URL を理解
- 通常接続（IPv6）と Session Pooler（IPv4）の違いを理解
- EC2 からは Session Pooler を使う必要があることを確認
- 正しい接続 URL を抽出し、Spring Boot 用に変換

⚙️ 3. Spring Boot の DB 設定を Supabase 用に書き換え
- application.properties を PostgreSQL 用に変更
- H2 の設定を削除して、Supabase に完全移行
- ddl-auto=none で安全に運用できる形に整備

📦 4. PostgreSQL JDBC ドライバを追加
- Tomcat 起動エラーの原因を特定
- org.postgresql.Driver が無いことを発見
- Maven/Gradle に PostgreSQL 依存を追加して解決
- アプリが正常起動するところまで確認

📝 5. 一日限定 Todo のアイデアを整理
- 「24時間で自動削除される Todo」構想を検討
- Supabase 側で自動削除する方法
- Spring Boot 側で削除する方法
- どちらも安全に実装できる方向性を確認

## 2026/01/25まとめ
1. EC2 インスタンスの作成
- 新しい EC2 インスタンスを起動
- セキュリティグループを一度削除し、重複バグを回避
- 新しいセキュリティグループを作成（SSH/HTTP/8080 を許可）

2. SSH 接続の確立
- 鍵ファイルの正しい場所を確認
- パスを修正して SSH 接続に成功
- EC2 内の操作ができる状態に

3. Java のインストール
- Amazon Linux 2023 に Java 17 をインストール
- java -version で動作確認

4. アプリ（jar）の準備と転送
- Gradle の build/libs に生成された
todo-0.0.1-SNAPSHOT.jar を確認
- scp を使ってローカル → EC2 へファイル転送
- 転送成功（39MB の大きな jar をしっかり送れた）

5. EC2 上でアプリ起動
- EC2 に再ログイン
- jar ファイルを確認
- java -jar todo-0.0.1-SNAPSHOT.jar で起動
- Spring Boot が正常に立ち上がる

6. ブラウザで動作確認
- http://43.206.147.251:8080 にアクセス
- アプリ画面の表示を確認
- クラウド公開成功！

2025/01/27作業内容まとめ
1. Supabase に Edge Function を作成
- 名前：delete-old-tasks
- 内容：
tasks テーブルから 今日より前の日付のタスクを削除する処理を実装
- 動作確認：Supabase の Function Logs でテスト実行して成功

2. Supabase の API キーと URL を確認
- anon public key を取得
- 関数のエンドポイント URL を確認
例：
https://xxxx.supabase.co/functions/v1/delete-old-tasks

3. GitHub Secrets に必要な値を登録
GitHub → Settings → Secrets → Actions に以下を追加：
|  |  | 
| SUPABASE_FUNCTION_URL |  | 
| SUPABASE_ANON_KEY |  | 



4. GitHub Actions の workflow を作成
.github/workflows/delete-old-tasks.yml を作成し push：
- 毎日 0:00（日本時間）に実行される cron 設定
- Supabase 関数を curl で叩く処理を記述
- workflow_dispatch: で手動実行も可能に

5. GitHub Actions が動かずエラー → 修正
- exit code 3（URL 形式エラー）
- 原因：Secrets の URL が誤っていた
- 修正後、GitHub Actions が正常に実行されるようになった

6. Supabase にテストデータを挿入
- tasks テーブルの構造に合わせて
summary / description / status / created_at を持つ10件のデータを挿入
- すべて今日の日付に統一したデータも挿入

7. 自動削除の動作仕様を確認
- 削除条件：
created_at < 今日の日付
- 今日の日付のデータは削除されない
- 古いデータを入れれば、夜0時に自動削除される

2026/01/30まとめ（完全版）
1. Spring Boot アプリの HTML を修正
- IntelliJ でテンプレート（Thymeleaf）を編集
- 表示内容を変更したが、EC2 では反映されず
→ 原因調査へ

2. Jar を再ビルドしようとして PowerShell の実行方法を修正
- gradlew.bat build が動かず
- PowerShell の仕様で .\gradlew.bat build が必要と判明
- 正しくビルドできた（BUILD SUCCESSFUL）

3. 新しい jar を EC2 にアップロード
- scp コマンドで最新 jar を上書きアップロード
- 転送成功（39MB）

4. systemd の再起動を試みるが、Windows で sudo を実行してしまう
- PowerShell で sudo を実行 → エラー
- 正しくは EC2 に SSH 接続してから sudo を使う と理解

5. EC2 でサービス再起動 → 起動失敗
- sudo systemctl restart todo
- status を確認すると ClassNotFoundException が発生

6. ログ解析で原因を特定
エラー内容：
ClassNotFoundException: org.springframework.boot.web.server.GracefulShutdownCallback


→ Spring Boot 3 では削除されたクラス
→ プロジェクト内には使っていない
→ 依存ライブラリのどれかが Spring Boot 2.x の API を参照していると判明

7. build.gradle を確認 → 問題の依存を発見
原因の依存：
webjars-locator-core:0.52


これは Spring Boot 2.x 時代のライブラリで、
内部で削除済み API を参照していた。

8. 問題の依存を削除して clean build
- build.gradle から webjars-locator-core を削除
- .\gradlew.bat clean build で完全再ビルド
- 新しい jar を再アップロード

9. EC2 でサービス再起動 → 成功
- sudo systemctl restart todo
- sudo systemctl status todo
→ active (running) に復帰
→ アプリが正常起動

